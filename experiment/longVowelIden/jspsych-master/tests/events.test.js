const utils=require("./testing-utils.js");describe("on_finish (trial)",function(){test("should get an object of data generated by the trial",function(){return require("../jspsych.js"),require("../plugins/jspsych-html-keyboard-response.js"),new Promise(function(e){var t=null,s={type:"html-keyboard-response",stimulus:"hello",on_finish:function(e){t=e.key_press}};jsPsych.init({timeline:[s],on_finish:function(){e({key_data:t})}}),utils.pressKey(32)}).then(function(e){expect(e.key_data).toBe(32)})}),test("should be able to write to the data",function(){return require("../jspsych.js"),require("../plugins/jspsych-html-keyboard-response.js"),new Promise(function(e){var t={},s={type:"html-keyboard-response",stimulus:"hello",on_finish:function(e){e.key_press=1}};jsPsych.init({timeline:[s],on_finish:function(){t.final_key_press=jsPsych.data.get().values()[0].key_press,e(t)}}),utils.pressKey(32)}).then(function(e){expect(e.final_key_press).toBe(1)})})}),describe("on_trial_finish (experiment level)",function(){test("should get an object containing the trial data",function(){return require("../jspsych.js"),require("../plugins/jspsych-html-keyboard-response.js"),new Promise(function(e){var t={},s={type:"html-keyboard-response",stimulus:"hello"};jsPsych.init({timeline:[s],on_trial_finish:function(e){t.key=e.key_press},on_finish:function(){e(t)}}),utils.pressKey(32)}).then(function(e){expect(e.key).toBe(32)})}),test("should allow writing to the data object",function(){return require("../jspsych.js"),require("../plugins/jspsych-html-keyboard-response.js"),new Promise(function(e){var t={},s={type:"html-keyboard-response",stimulus:"hello"};jsPsych.init({timeline:[s],on_trial_finish:function(e){e.write=!0},on_finish:function(s){t.write=s.values()[0].write,e(t)}}),utils.pressKey(32)}).then(function(e){expect(e.write).toBe(!0)})})}),describe("on_data_update",function(){test("should get an object containing the trial data",function(){return require("../jspsych.js"),require("../plugins/jspsych-html-keyboard-response.js"),new Promise(function(e){var t={},s={type:"html-keyboard-response",stimulus:"hello"};jsPsych.init({timeline:[s],on_data_update:function(e){t.key=e.key_press},on_finish:function(){e(t)}}),utils.pressKey(32)}).then(function(e){expect(e.key).toBe(32)})}),test("should contain data added with on_finish (trial level)",function(){return require("../jspsych.js"),require("../plugins/jspsych-html-keyboard-response.js"),new Promise(function(e){var t={},s={type:"html-keyboard-response",stimulus:"hello",on_finish:function(e){e.trial_level=!0}};jsPsych.init({timeline:[s],on_data_update:function(e){t.trial_level=e.trial_level},on_finish:function(){e(t)}}),utils.pressKey(32)}).then(function(e){expect(e.trial_level).toBe(!0)})}),test("should contain data added with on_trial_finish (experiment level)",function(){return require("../jspsych.js"),require("../plugins/jspsych-html-keyboard-response.js"),new Promise(function(e){var t={},s={type:"html-keyboard-response",stimulus:"hello"};jsPsych.init({timeline:[s],on_trial_finish:function(e){e.experiment_level=!0},on_data_update:function(e){t.experiment_level=e.experiment_level},on_finish:function(){e(t)}}),utils.pressKey(32)}).then(function(e){expect(e.experiment_level).toBe(!0)})})}),describe("on_trial_start",function(){test("should get an object containing the trial properties",function(){return require("../jspsych.js"),require("../plugins/jspsych-html-keyboard-response.js"),new Promise(function(e){var t={},s={type:"html-keyboard-response",stimulus:"hello"};jsPsych.init({timeline:[s],on_trial_start:function(e){t.text=e.stimulus},on_finish:function(){e(t)}}),utils.pressKey(32)}).then(function(e){expect(e.text).toBe("hello")})}),test("should allow modification of the trial properties",function(){require("../jspsych.js"),require("../plugins/jspsych-html-keyboard-response.js");var e={type:"html-keyboard-response",stimulus:"hello"};jsPsych.init({timeline:[e],on_trial_start:function(e){e.stimulus="goodbye"},on_finish:function(){resolve(promise_data)}});var t=jsPsych.getDisplayElement();expect(t.innerHTML).toMatch("goodbye"),utils.pressKey(32)})});