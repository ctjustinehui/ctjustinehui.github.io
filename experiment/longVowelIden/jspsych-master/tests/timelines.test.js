const root="../",utils=require("./testing-utils.js");beforeEach(function(){require(root+"jspsych.js"),require(root+"plugins/jspsych-html-keyboard-response.js")}),describe("loop function",function(){test("repeats a timeline when returns true",function(){var e=0,t={timeline:[{type:"html-keyboard-response",stimulus:"foo"}],loop_function:function(){return e<1&&(e++,!0)}};jsPsych.init({timeline:[t]}),utils.pressKey(32),expect(jsPsych.data.get().count()).toBe(1),utils.pressKey(32),expect(jsPsych.data.get().count()).toBe(2)}),test("does not repeat when returns false",function(){var e={timeline:[{type:"html-keyboard-response",stimulus:"foo"}],loop_function:function(){return!1}};jsPsych.init({timeline:[e]}),utils.pressKey(32),expect(jsPsych.data.get().count()).toBe(1),utils.pressKey(32),expect(jsPsych.data.get().count()).toBe(1)}),test("gets the data from the most recent iteration",function(){var e=[],t=0,s={timeline:[{type:"html-keyboard-response",stimulus:"foo"}],loop_function:function(s){return e.push(s.count()),t<2&&(t++,!0)}};jsPsych.init({timeline:[s]}),utils.pressKey(32),utils.pressKey(32),utils.pressKey(32),expect(e).toEqual([1,1,1]),expect(jsPsych.data.get().count()).toBe(3)})}),describe("conditional function",function(){test("skips the timeline when returns false",function(){var e={timeline:[{type:"html-keyboard-response",stimulus:"foo"}],conditional_function:function(){return!1}},t={type:"html-keyboard-response",stimulus:"bar"};jsPsych.init({timeline:[e,t]}),expect(jsPsych.getDisplayElement().innerHTML).toMatch("bar"),utils.pressKey(32)}),test("completes the timeline when returns true",function(){var e={timeline:[{type:"html-keyboard-response",stimulus:"foo"}],conditional_function:function(){return!0}},t={type:"html-keyboard-response",stimulus:"bar"};jsPsych.init({timeline:[e,t]}),expect(jsPsych.getDisplayElement().innerHTML).toMatch("foo"),utils.pressKey(32),expect(jsPsych.getDisplayElement().innerHTML).toMatch("bar"),utils.pressKey(32)}),test("executes on every loop of the timeline",function(){var e=0,t=0,s={timeline:[{type:"html-keyboard-response",stimulus:"foo"}],loop_function:function(){return e<1&&(e++,!0)},conditional_function:function(){return t++,!0}};jsPsych.init({timeline:[s]}),expect(t).toBe(1),utils.pressKey(32),expect(t).toBe(2),utils.pressKey(32),expect(t).toBe(2)})}),describe("endCurrentTimeline",function(){test("stops the current timeline, skipping to the end after the trial completes",function(){var e={timeline:[{type:"html-keyboard-response",stimulus:"foo",on_finish:function(){jsPsych.endCurrentTimeline()}},{type:"html-keyboard-response",stimulus:"bar"}]},t={type:"html-keyboard-response",stimulus:"woo"};jsPsych.init({timeline:[e,t]}),expect(jsPsych.getDisplayElement().innerHTML).toMatch("foo"),utils.pressKey(32),expect(jsPsych.getDisplayElement().innerHTML).toMatch("woo"),utils.pressKey(32)})});