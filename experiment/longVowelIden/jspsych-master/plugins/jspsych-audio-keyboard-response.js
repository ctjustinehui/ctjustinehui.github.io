jsPsych.plugins["audio-keyboard-response"]=function(){var e={};return jsPsych.pluginAPI.registerPreload("audio-keyboard-response","stimulus","audio"),e.info={name:"audio-keyboard-response",description:"",parameters:{stimulus:{type:jsPsych.plugins.parameterType.AUDIO,pretty_name:"Stimulus","default":undefined,description:"The audio to be played."},choices:{type:jsPsych.plugins.parameterType.KEYCODE,pretty_name:"Choices",array:!0,"default":jsPsych.ALL_KEYS,description:"The keys the subject is allowed to press to respond to the stimulus."},prompt:{type:jsPsych.plugins.parameterType.STRING,pretty_name:"Prompt","default":"",description:"Any content here will be displayed below the stimulus."},trial_duration:{type:jsPsych.plugins.parameterType.INT,pretty_name:"Trial duration","default":-1,description:"The maximum duration to wait for a response."},response_ends_trial:{type:jsPsych.plugins.parameterType.BOOL,pretty_name:"Response ends trial","default":!0,description:"If true, the trial will end when user makes a response."},trial_ends_after_audio:{type:jsPsych.plugins.parameterType.BOOL,pretty_name:"Trial ends after audio","default":!1,description:"If true, then the trial will end as soon as the audio file finishes playing."}}},e.trial=function(e,t){function s(){jsPsych.pluginAPI.clearAllTimeouts(),null!==i?(n.stop(),n.onended=function(){}):(r.pause(),r.removeEventListener("ended",s)),jsPsych.pluginAPI.cancelAllKeyboardResponses();var o={rt:null!==i?1e3*a.rt:a.rt,stimulus:t.stimulus,key_press:a.key};e.innerHTML="",jsPsych.finishTrial(o)}var i=jsPsych.pluginAPI.audioContext();if(null!==i){var n=i.createBufferSource();n.buffer=jsPsych.pluginAPI.getAudioBuffer(t.stimulus),n.connect(i.destination)}else{var r=jsPsych.pluginAPI.getAudioBuffer(t.stimulus);r.currentTime=0}t.trial_ends_after_audio&&(null!==i?n.onended=function(){s()}:r.addEventListener("ended",s)),""!==t.prompt&&(e.innerHTML=t.prompt);var a={rt:-1,key:-1},o=function(e){-1==a.key&&(a=e),t.response_ends_trial&&s()};if(null!==i?(startTime=i.currentTime+.1,n.start(startTime)):r.play(),null!==i)jsPsych.pluginAPI.getKeyboardResponse({callback_function:o,valid_responses:t.choices,rt_method:"audio",persist:!1,allow_held_key:!1,audio_context:i,audio_context_start_time:startTime});else jsPsych.pluginAPI.getKeyboardResponse({callback_function:o,valid_responses:t.choices,rt_method:"date",persist:!1,allow_held_key:!1});t.trial_duration>0&&jsPsych.pluginAPI.setTimeout(function(){s()},t.trial_duration)},e}();