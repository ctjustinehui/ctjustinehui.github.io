jsPsych.plugins["free-sort"]=function(){function e(e,t){return{x:Math.floor(Math.random()*(e-1)),y:Math.floor(Math.random()*(t-1))}}var t={};return jsPsych.pluginAPI.registerPreload("free-sort","stimuli","image"),t.info={name:"free-sort",description:"",parameters:{stimuli:{type:jsPsych.plugins.parameterType.STRING,pretty_name:"Stimuli","default":undefined,array:!0,description:"Images to be displayed."},stim_height:{type:jsPsych.plugins.parameterType.INT,pretty_name:"Stimulus height","default":100,description:"Height of images in pixels."},stim_width:{type:jsPsych.plugins.parameterType.INT,pretty_name:"Stimulus width","default":100,description:"Width of images in pixels"},sort_area_height:{type:jsPsych.plugins.parameterType.INT,pretty_name:"Sort area height","default":800,description:"The height of the container that subjects can move the stimuli in."},sort_area_width:{type:jsPsych.plugins.parameterType.INT,pretty_name:"Sort area width","default":800,description:"The width of the container that subjects can move the stimuli in."},prompt:{type:jsPsych.plugins.parameterType.STRING,pretty_name:"Prompt","default":"",description:"It can be used to provide a reminder about the action the subject is supposed to take."},prompt_location:{type:jsPsych.plugins.parameterType.SELECT,pretty_name:"Prompt location",options:["above","below"],"default":"above",description:'Indicates whether to show prompt "above" or "below" the sorting area.'},button_label:{type:jsPsych.plugins.parameterType.STRING,pretty_name:"Button label","default":"Continue",description:"The text that appears on the button to continue to the next trial."}}},t.trial=function(t,r){var s=(new Date).getTime(),i="";r.prompt&&"above"==r.prompt_location&&(i+=r.prompt),i+='<div id="jspsych-free-sort-arena" class="jspsych-free-sort-arena" style="position: relative; width:'+r.sort_area_width+"px; height:"+r.sort_area_height+'px; border:2px solid #444;"></div>',r.prompt&&"below"==r.prompt_location&&(i+=r.prompt),t.innerHTML=i;for(var a=[],o=0;o<r.stimuli.length;o++){var n=e(r.sort_area_width-r.stim_width,r.sort_area_height-r.stim_height);t.querySelector("#jspsych-free-sort-arena").innerHTML+='<img src="'+r.stimuli[o]+'" data-src="'+r.stimuli[o]+'" class="jspsych-free-sort-draggable" draggable="false" style="position: absolute; cursor: move; width:'+r.stim_width+"px; height:"+r.stim_height+"px; top:"+n.y+"px; left:"+n.x+'px;"></img>',a.push({src:r.stimuli[o],x:n.x,y:n.y})}t.innerHTML+='<button id="jspsych-free-sort-done-btn" class="jspsych-btn">'+r.button_label+"</button>";var p=1,h=[],l=t.querySelectorAll(".jspsych-free-sort-draggable");for(o=0;o<l.length;o++)l[o].addEventListener("mousedown",function(e){var t=e.pageX-e.currentTarget.offsetLeft,s=e.pageY-e.currentTarget.offsetTop-window.scrollY,i=e.currentTarget;i.style.zIndex=++p;var a=function(e){i.style.top=Math.min(r.sort_area_height-r.stim_height,Math.max(0,e.clientY-s))+"px",i.style.left=Math.min(r.sort_area_width-r.stim_width,Math.max(0,e.clientX-t))+"px"};document.addEventListener("mousemove",a);var o=function(){document.removeEventListener("mousemove",a),h.push({src:i.dataset.src,x:i.offsetLeft,y:i.offsetTop}),document.removeEventListener("mouseup",o)};document.addEventListener("mouseup",o)});t.querySelector("#jspsych-free-sort-done-btn").addEventListener("click",function(){for(var e=(new Date).getTime()-s,r=[],i=t.querySelectorAll(".jspsych-free-sort-draggable"),o=0;o<i.length;o++)r.push({src:i[o].dataset.src,x:i[o].style.position.left,y:i[o].style.position.top});var n={init_locations:JSON.stringify(a),moves:JSON.stringify(h),final_locations:JSON.stringify(r),rt:e};t.innerHTML="",jsPsych.finishTrial(n)})},t}();