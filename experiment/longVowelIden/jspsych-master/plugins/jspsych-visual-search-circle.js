jsPsych.plugins["visual-search-circle"]=function(){function e(e){return Math.cos(e/180*Math.PI)}function t(e){return Math.sin(e/180*Math.PI)}var i={};return jsPsych.pluginAPI.registerPreload("visual-search-circle","target","image"),jsPsych.pluginAPI.registerPreload("visual-search-circle","foil","image"),jsPsych.pluginAPI.registerPreload("visual-search-circle","fixation_image","image"),i.info={name:"visual-search-circle",description:"",parameters:{target:{type:jsPsych.plugins.parameterType.IMAGE,pretty_name:"Target","default":undefined,description:"The image to be displayed."},foil:{type:jsPsych.plugins.parameterType.IMAGE,pretty_name:"Foil","default":undefined,description:"Path to image file that is the foil/distractor."},fixation_image:{type:jsPsych.plugins.parameterType.IMAGE,pretty_name:"Fixation image","default":undefined,description:"Path to image file that is a fixation target."},set_size:{type:jsPsych.plugins.parameterType.INT,pretty_name:"Set size","default":undefined,description:"How many items should be displayed?"},target_present:{type:jsPsych.plugins.parameterType.BOOL,pretty_name:"Target present","default":!0,description:"Is the target present?"},target_size:{type:jsPsych.plugins.parameterType.INT,pretty_name:"Target size",array:!0,"default":[50,50],description:"Two element array indicating the height and width of the search array element images."},fixation_size:{type:jsPsych.plugins.parameterType.INT,pretty_name:"Fixation size",array:!0,"default":[16,16],description:"Two element array indicating the height and width of the fixation image."},circle_diameter:{type:jsPsych.plugins.parameterType.INT,pretty_name:"Circle diameter","default":250,description:"The diameter of the search array circle in pixels."},target_present_key:{type:jsPsych.plugins.parameterType.KEYCODE,pretty_name:"Target present key","default":"j",description:"The key to press if the target is present in the search array."},target_absent_key:{type:jsPsych.plugins.parameterType.KEYCODE,pretty_name:"Target absent key","default":"f",description:"The key to press if the the target is not present in the search array."},trial_duration:{type:jsPsych.plugins.parameterType.INT,pretty_name:"Trial duration","default":-1,description:"The maximum duration to wait for a response."},fixation_duration:{type:jsPsych.plugins.parameterType.INT,pretty_name:"Fixation duration","default":1e3,description:"How long to show the fixation image for before the search array (in milliseconds)."}}},i.trial=function(i,a){function r(){_.innerHTML+="<img src='"+a.fixation_image+"' style='position: absolute; top:"+h[0]+"px; left:"+h[1]+"px; width:"+a.fixation_size[0]+"px; height:"+a.fixation_size[1]+"px;'></img>",jsPsych.pluginAPI.setTimeout(function(){s()},a.fixation_duration)}function s(){function e(){i.innerHTML=""}var t=[];a.target_present&&t.push(a.target),t=t.concat(a.foil);for(var r=0;r<g.length;r++)_.innerHTML+="<img src='"+t[r]+"' style='position: absolute; top:"+g[r][0]+"px; left:"+g[r][1]+"px; width:"+a.target_size[0]+"px; height:"+a.target_size[1]+"px;'></img>";var s=!1,o=function(t){s=!0;var i=0;(t.key==a.target_present_key&&a.target_present||t.key==a.target_absent_key&&!a.target_present)&&(i=1),e(),n(t.rt,i,t.key)},p=[a.target_present_key,a.target_absent_key];if(key_listener=jsPsych.pluginAPI.getKeyboardResponse({callback_function:o,valid_responses:p,rt_method:"date",persist:!1,allow_held_key:!1}),a.trial_duration>-1)if(0==a.trial_duration){if(!s){jsPsych.pluginAPI.cancelKeyboardResponse(key_listener),s=!0;var l=-1,c=0,y=-1;e(),n(l,c,y)}}else jsPsych.pluginAPI.setTimeout(function(){if(!s){jsPsych.pluginAPI.cancelKeyboardResponse(key_listener),s=!0;var t=-1,i=0,a=-1;e(),n(t,i,a)}},a.trial_duration)}function n(e,t,i){var r={correct:t,rt:e,key_press:i,locations:JSON.stringify(g),target_present:a.target_present,set_size:a.set_size};jsPsych.finishTrial(r)}for(var o=a.circle_diameter,p=o/2,l=o+a.target_size[0],c=a.target_size[0]/2,y=a.target_size[1]/2,h=[Math.floor(l/2-a.fixation_size[0]/2),Math.floor(l/2-a.fixation_size[1]/2)],g=[],f=a.set_size,u=Math.floor(360*Math.random()),d=0;d<f;d++)g.push([Math.floor(l/2+e(u+d*(360/f))*p-y),Math.floor(l/2-t(u+d*(360/f))*p-c)]);i.innerHTML+='<div id="jspsych-visual-search-circle-container" style="position: relative; width:'+l+"px; height:"+l+'px"></div>';var _=i.querySelector("#jspsych-visual-search-circle-container");if(!Array.isArray(a.foil)){fa=[];for(d=0;d<a.set_size;d++)fa.push(a.foil);a.foil=fa}r()},i}();