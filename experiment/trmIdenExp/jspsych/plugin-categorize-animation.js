var jsPsychCategorizeAnimation=function(e){"use strict";const t={name:"categorize-animation",parameters:{stimuli:{type:e.ParameterType.IMAGE,pretty_name:"Stimuli","default":undefined,array:!0},key_answer:{type:e.ParameterType.KEY,pretty_name:"Key answer","default":undefined},choices:{type:e.ParameterType.KEYS,pretty_name:"Choices","default":"ALL_KEYS"},text_answer:{type:e.ParameterType.HTML_STRING,pretty_name:"Text answer","default":null},correct_text:{type:e.ParameterType.HTML_STRING,pretty_name:"Correct text","default":"Correct."},incorrect_text:{type:e.ParameterType.HTML_STRING,pretty_name:"Incorrect text","default":"Wrong."},frame_time:{type:e.ParameterType.INT,pretty_name:"Frame time","default":500},sequence_reps:{type:e.ParameterType.INT,pretty_name:"Sequence repetitions","default":1},allow_response_before_complete:{type:e.ParameterType.BOOL,pretty_name:"Allow response before complete","default":!1},feedback_duration:{type:e.ParameterType.INT,pretty_name:"Feedback duration","default":2e3},prompt:{type:e.ParameterType.HTML_STRING,pretty_name:"Prompt","default":null},render_on_canvas:{type:e.ParameterType.BOOL,pretty_name:"Render on canvas","default":!0}}};class r{constructor(e){this.jsPsych=e}trial(e,t){var r,a=0,n=0,s=!0,i=!1,l=!1;if(t.render_on_canvas){if(e.hasChildNodes())for(;e.firstChild;)e.removeChild(e.firstChild);var o=document.createElement("canvas");o.id="jspsych-categorize-animation-stimulus",o.style.margin="0",o.style.padding="0",e.insertBefore(o,null);var c=o.getContext("2d");if(null!==t.prompt){var m=document.createElement("div");m.id="jspsych-categorize-animation-prompt",m.style.visibility="hidden",m.innerHTML=t.prompt,e.insertBefore(m,o.nextElementSibling)}var p=document.createElement("div");e.insertBefore(p,e.nextElementSibling)}const u=()=>{if(s)if(t.render_on_canvas){e.querySelector("#jspsych-categorize-animation-stimulus").style.visibility="visible";var n=new Image;n.src=t.stimuli[a],o.height=n.naturalHeight,o.width=n.naturalWidth,c.drawImage(n,0,0)}else e.innerHTML+='<img src="'+t.stimuli[a]+'" class="jspsych-categorize-animation-stimulus"></img>';if(!i&&t.allow_response_before_complete)null!==t.prompt&&(t.render_on_canvas?m.style.visibility="visible":e.innerHTML+=t.prompt),t.render_on_canvas&&(s||o.remove());else if(i){var u="";u=r?t.correct_text.replace("%ANS%",t.text_answer):t.incorrect_text.replace("%ANS%",t.text_answer),t.render_on_canvas?(null!==t.prompt&&m.remove(),p.innerHTML=u):e.innerHTML+=u,l||(l=!0,this.jsPsych.pluginAPI.setTimeout(()=>{_()},t.feedback_duration))}else s||(null!==t.prompt&&(t.render_on_canvas?m.style.visibility="visible":e.innerHTML+=t.prompt),t.render_on_canvas&&o.remove())};var y=setInterval(()=>{t.render_on_canvas||(e.innerHTML=""),++a==t.stimuli.length&&(a=0,n++,-1!=t.sequence_reps&&n>=t.sequence_reps&&(s=!1)),u()},t.frame_time);u();const _=()=>{clearInterval(y),e.innerHTML="",this.jsPsych.finishTrial(h)};var d,h={};const f=e=>{if(!t.allow_response_before_complete&&s)return!1;r=!1,this.jsPsych.pluginAPI.compareKeys(t.key_answer,e.key)&&(r=!0),i=!0,h={stimulus:t.stimuli,rt:e.rt,correct:r,response:e.key},this.jsPsych.pluginAPI.cancelKeyboardResponse(d)};d=this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:f,valid_responses:t.choices,rt_method:"performance",persist:!0,allow_held_key:!1})}simulate(e,t,r,a){"data-only"==t&&(a(),this.simulate_data_only(e,r)),"visual"==t&&this.simulate_visual(e,r,a)}create_simulation_data(e,t){const r=e.sequence_reps*e.frame_time*e.stimuli.length,a=this.jsPsych.pluginAPI.getValidKey(e.choices),n={stimulus:e.stimuli,rt:r+this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),response:a,correct:a==e.key_answer},s=this.jsPsych.pluginAPI.mergeSimulationData(n,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,s),s}simulate_data_only(e,t){const r=this.create_simulation_data(e,t);if(null==r.rt||null==r.response)throw new Error("\n        Simulated response for categorize-animation plugin was invalid. \n        This could be because the response RT was too fast and generated\n        before the animation finished when the allow_response_before_complete\n        parameter is false. In a real experiment this would cause the experiment\n        to pause indefinitely.");this.jsPsych.finishTrial(r)}simulate_visual(e,t,r){const a=this.create_simulation_data(e,t),n=this.jsPsych.getDisplayElement();if(this.trial(n,e),r(),null===a.rt)throw new Error("\n        Simulated response for categorize-animation plugin was invalid. \n        This could be because the response RT was too fast and generated\n        before the animation finished when the allow_response_before_complete\n        parameter is false. In a real experiment this would cause the experiment\n        to pause indefinitely.");this.jsPsych.pluginAPI.pressKey(a.response,a.rt)}}return r.info=t,r}(jsPsychModule);