var jsPsychExternalHtml=function(e){"use strict";const t={name:"external-html",parameters:{url:{type:e.ParameterType.STRING,pretty_name:"URL","default":undefined},cont_key:{type:e.ParameterType.KEY,pretty_name:"Continue key","default":null},cont_btn:{type:e.ParameterType.STRING,pretty_name:"Continue button","default":null},check_fn:{type:e.ParameterType.FUNCTION,pretty_name:"Check function","default":()=>!0},force_refresh:{type:e.ParameterType.BOOL,pretty_name:"Force refresh","default":!1},execute_script:{type:e.ParameterType.BOOL,pretty_name:"Execute scripts","default":!1}}};class n{constructor(e){this.jsPsych=e}trial(e,t,n){let r;var a=t.url;return t.force_refresh&&(a=t.url+"?t="+performance.now()),fetch(a).then(e=>e.text()).then(a=>{e.innerHTML=a,n();var s=performance.now();const i=e=>{this.jsPsych.pluginAPI.compareKeys(e.key,t.cont_key)&&c()},c=()=>{if(!t.check_fn||t.check_fn(e)){t.cont_key&&e.removeEventListener("keydown",i);var n={rt:Math.round(performance.now()-s),url:t.url};e.innerHTML="",this.jsPsych.finishTrial(n),r()}};if(t.execute_script)for(var l=e.getElementsByTagName("script"),o=0;o<l.length;o++){const e=document.createElement("script"),t=l[o];e.text=t.text,t.parentNode.replaceChild(e,t)}t.cont_btn&&e.querySelector("#"+t.cont_btn).addEventListener("click",c),t.cont_key&&e.addEventListener("keydown",i)})["catch"](e=>{console.error("Something went wrong with fetch() in plugin-external-html.",e)}),new Promise(e=>{r=e})}simulate(e,t,n,r){"data-only"==t&&(r(),this.simulate_data_only(e,n)),"visual"==t&&this.simulate_visual(e,n,r)}create_simulation_data(e,t){const n={url:e.url,rt:this.jsPsych.randomization.sampleExGaussian(2e3,200,.005,!0)},r=this.jsPsych.pluginAPI.mergeSimulationData(n,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,r),r}simulate_data_only(e,t){const n=this.create_simulation_data(e,t);this.jsPsych.finishTrial(n)}simulate_visual(e,t,n){const r=this.create_simulation_data(e,t),a=this.jsPsych.getDisplayElement();this.trial(a,e,()=>{n(),e.cont_key?this.jsPsych.pluginAPI.pressKey(e.cont_key,r.rt):e.cont_btn&&this.jsPsych.pluginAPI.clickTarget(a.querySelector("#"+e.cont_btn),r.rt)})}}return n.info=t,n}(jsPsychModule);