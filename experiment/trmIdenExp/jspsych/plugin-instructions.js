var jsPsychInstructions=function(e){"use strict";const t={name:"instructions",parameters:{pages:{type:e.ParameterType.HTML_STRING,pretty_name:"Pages","default":undefined,array:!0},key_forward:{type:e.ParameterType.KEY,pretty_name:"Key forward","default":"ArrowRight"},key_backward:{type:e.ParameterType.KEY,pretty_name:"Key backward","default":"ArrowLeft"},allow_backward:{type:e.ParameterType.BOOL,pretty_name:"Allow backward","default":!0},allow_keys:{type:e.ParameterType.BOOL,pretty_name:"Allow keys","default":!0},show_clickable_nav:{type:e.ParameterType.BOOL,pretty_name:"Show clickable nav","default":!1},show_page_number:{type:e.ParameterType.BOOL,pretty_name:"Show page number","default":!1},page_label:{type:e.ParameterType.STRING,pretty_name:"Page label","default":"Page"},button_label_previous:{type:e.ParameterType.STRING,pretty_name:"Button label previous","default":"Previous"},button_label_next:{type:e.ParameterType.STRING,pretty_name:"Button label next","default":"Next"}}};class a{constructor(e){this.jsPsych=e}trial(e,t){function a(e){e.target.removeEventListener("click",a),"jspsych-instructions-back"===this.id?n():"jspsych-instructions-next"===this.id&&i()}function s(){var s=t.pages[o],i="";if(t.show_page_number&&(i="<span style='margin: 0 1em;' class='jspsych-instructions-pagenum'>"+t.page_label+" "+(o+1)+"/"+t.pages.length+"</span>"),t.show_clickable_nav){var n="<div class='jspsych-instructions-nav' style='padding: 10px 0px;'>";if(t.allow_backward)n+="<button id='jspsych-instructions-back' class='jspsych-btn' style='margin-right: 5px;' "+(o>0?"":"disabled='disabled'")+">&lt; "+t.button_label_previous+"</button>";t.pages.length>1&&t.show_page_number&&(n+=i),s+=n+="<button id='jspsych-instructions-next' class='jspsych-btn'style='margin-left: 5px;'>"+t.button_label_next+" &gt;</button></div>",e.innerHTML=s,0!=o&&t.allow_backward&&e.querySelector("#jspsych-instructions-back").addEventListener("click",a),e.querySelector("#jspsych-instructions-next").addEventListener("click",a)}else t.show_page_number&&t.pages.length>1&&(s+="<div class='jspsych-instructions-pagenum'>"+i+"</div>"),e.innerHTML=s}function i(){r(),++o>=t.pages.length?p():s()}function n(){r(),o--,s()}function r(){var e=performance.now(),t=Math.round(e-y);l.push({page_index:o,viewing_time:t}),y=e}var o=0,l=[],c=performance.now(),y=c;const p=()=>{t.allow_keys&&this.jsPsych.pluginAPI.cancelKeyboardResponse(_),e.innerHTML="";var a={view_history:l,rt:Math.round(performance.now()-c)};this.jsPsych.finishTrial(a)},h=e=>{_=this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:h,valid_responses:[t.key_forward,t.key_backward],rt_method:"performance",persist:!1,allow_held_key:!1}),this.jsPsych.pluginAPI.compareKeys(e.key,t.key_backward)&&0!==o&&t.allow_backward&&n(),this.jsPsych.pluginAPI.compareKeys(e.key,t.key_forward)&&i()};if(s(),t.allow_keys)var _=this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:h,valid_responses:[t.key_forward,t.key_backward],rt_method:"performance",persist:!1})}simulate(e,t,a,s){"data-only"==t&&(s(),this.simulate_data_only(e,a)),"visual"==t&&this.simulate_visual(e,a,s)}create_simulation_data(e,t){var a,s,i,n,r,o;let l=0,c=0,y=[];if(!(null===(a=t.data)||void 0===a?void 0:a.view_history)&&!(null===(s=t.data)||void 0===s?void 0:s.rt))for(;l!==e.pages.length;){const t=Math.round(this.jsPsych.randomization.sampleExGaussian(3e3,300,1/300));y.push({page_index:l,viewing_time:t}),c+=t,0!=l&&e.allow_backward?1==this.jsPsych.randomization.sampleBernoulli(.9)?l++:l--:l++}if(!(null===(i=t.data)||void 0===i?void 0:i.view_history)&&(null===(n=t.data)||void 0===n?void 0:n.rt)){for(c=t.data.rt;l!==e.pages.length;)y.push({page_index:l,viewing_time:null}),0!=l&&e.allow_backward?1==this.jsPsych.randomization.sampleBernoulli(.9)?l++:l--:l++;const a=t.data.rt/y.length;let s=0;for(const e of y){const t=Math.round(this.jsPsych.randomization.sampleExGaussian(a,a/10,1/(a/10)));e.viewing_time=t,s+=t}const i=t.data.rt-s,n=Math.round(i/y.length);for(const e of y)e.viewing_time+=n}if((null===(r=t.data)||void 0===r?void 0:r.view_history)&&!(null===(o=t.data)||void 0===o?void 0:o.rt)){y=t.data.view_history,c=0;for(const e of t.data.view_history)c+=e.viewing_time}const p={view_history:y,rt:c},h=this.jsPsych.pluginAPI.mergeSimulationData(p,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,h),h}simulate_data_only(e,t){const a=this.create_simulation_data(e,t);this.jsPsych.finishTrial(a)}simulate_visual(e,t,a){const s=this.create_simulation_data(e,t),i=this.jsPsych.getDisplayElement();this.trial(i,e),a();const n=t=>{e.allow_keys?this.jsPsych.pluginAPI.pressKey(e.key_forward,t):e.show_clickable_nav&&this.jsPsych.pluginAPI.clickTarget(i.querySelector("#jspsych-instructions-next"),t)},r=t=>{e.allow_keys?this.jsPsych.pluginAPI.pressKey(e.key_backward,t):e.show_clickable_nav&&this.jsPsych.pluginAPI.clickTarget(i.querySelector("#jspsych-instructions-back"),t)};let o=0,l=0;for(let e=0;e<s.view_history.length;e++)e==s.view_history.length-1?n(l+s.view_history[e].viewing_time):(s.view_history[e+1].page_index>o&&n(l+s.view_history[e].viewing_time),s.view_history[e+1].page_index<o&&r(l+s.view_history[e].viewing_time),l+=s.view_history[e].viewing_time,o=s.view_history[e+1].page_index)}}return a.info=t,a}(jsPsychModule);