var jsPsychAudioSliderResponse=function(e){"use strict";const t={name:"audio-slider-response",parameters:{stimulus:{type:e.ParameterType.AUDIO,pretty_name:"Stimulus","default":undefined},min:{type:e.ParameterType.INT,pretty_name:"Min slider","default":0},max:{type:e.ParameterType.INT,pretty_name:"Max slider","default":100},slider_start:{type:e.ParameterType.INT,pretty_name:"Slider starting value","default":50},step:{type:e.ParameterType.INT,pretty_name:"Step","default":1},labels:{type:e.ParameterType.HTML_STRING,pretty_name:"Labels","default":[],array:!0},slider_width:{type:e.ParameterType.INT,pretty_name:"Slider width","default":null},button_label:{type:e.ParameterType.STRING,pretty_name:"Button label","default":"Continue",array:!1},require_movement:{type:e.ParameterType.BOOL,pretty_name:"Require movement","default":!1},prompt:{type:e.ParameterType.HTML_STRING,pretty_name:"Prompt","default":null},trial_duration:{type:e.ParameterType.INT,pretty_name:"Trial duration","default":null},response_ends_trial:{type:e.ParameterType.BOOL,pretty_name:"Response ends trial","default":!0},trial_ends_after_audio:{type:e.ParameterType.BOOL,pretty_name:"Trial ends after audio","default":!1},response_allowed_while_playing:{type:e.ParameterType.BOOL,pretty_name:"Response allowed while playing","default":!0}}};class s{constructor(e){this.jsPsych=e}trial(e,t,s){function r(){document.querySelector("#jspsych-audio-slider-response-response").disabled=!1,t.require_movement||(document.querySelector("#jspsych-audio-slider-response-next").disabled=!1)}let i;var a,n,l=7.5,o=this.jsPsych.pluginAPI.audioContext();this.jsPsych.pluginAPI.getAudioBuffer(t.stimulus).then(e=>{null!==o?(this.audio=o.createBufferSource(),this.audio.buffer=e,this.audio.connect(o.destination)):(this.audio=e,this.audio.currentTime=0),d()})["catch"](e=>{console.error(`Failed to load audio file "${t.stimulus}". Try checking the file path. We recommend using the preload plugin to load audio files.`),console.error(e)});const d=()=>{t.trial_ends_after_audio&&this.audio.addEventListener("ended",u),t.response_allowed_while_playing||t.trial_ends_after_audio||this.audio.addEventListener("ended",r);var i='<div id="jspsych-audio-slider-response-wrapper" style="margin: 100px 0px;">';i+='<div class="jspsych-audio-slider-response-container" style="position:relative; margin: 0 auto 3em auto; width:',null!==t.slider_width?i+=t.slider_width+"px;":i+="auto;",i+='">',i+='<input type="range" class="jspsych-slider" value="'+t.slider_start+'" min="'+t.min+'" max="'+t.max+'" step="'+t.step+'" id="jspsych-audio-slider-response-response"',t.response_allowed_while_playing||(i+=" disabled"),i+="></input><div>";for(var d=0;d<t.labels.length;d++){var p=100/(t.labels.length-1),y=d*(100/(t.labels.length-1));i+='<div style="border: 1px solid transparent; display: inline-block; position: absolute; left:calc('+y+"% - ("+p+"% / 2) - "+(y-50)/50*100*l/100+"px); text-align: center; width: "+p+'%;">',i+='<span style="text-align: center; font-size: 80%;">'+t.labels[d]+"</span>",i+="</div>"}i+="</div>",i+="</div>",i+="</div>",null!==t.prompt&&(i+=t.prompt);var c="";if(!t.require_movement&&t.response_allowed_while_playing||(c="disabled"),i+='<button id="jspsych-audio-slider-response-next" class="jspsych-btn" '+c+">"+t.button_label+"</button>",e.innerHTML=i,n={rt:null,response:null},t.response_allowed_while_playing||(e.querySelector("#jspsych-audio-slider-response-response").disabled=!0,e.querySelector("#jspsych-audio-slider-response-next").disabled=!0),t.require_movement){const t=()=>{e.querySelector("#jspsych-audio-slider-response-next").disabled=!1};e.querySelector("#jspsych-audio-slider-response-response").addEventListener("mousedown",t),e.querySelector("#jspsych-audio-slider-response-response").addEventListener("touchstart",t),e.querySelector("#jspsych-audio-slider-response-response").addEventListener("change",t)}e.querySelector("#jspsych-audio-slider-response-next").addEventListener("click",()=>{var s=performance.now(),r=Math.round(s-a);null!==o&&(s=o.currentTime,r=Math.round(1e3*(s-a))),n.rt=r,n.response=e.querySelector("#jspsych-audio-slider-response-response").valueAsNumber,t.response_ends_trial?u():e.querySelector("#jspsych-audio-slider-response-next").disabled=!0}),a=performance.now(),null!==o?(a=o.currentTime,this.audio.start(a)):this.audio.play(),null!==t.trial_duration&&this.jsPsych.pluginAPI.setTimeout(()=>{u()},t.trial_duration),s()},u=()=>{this.jsPsych.pluginAPI.clearAllTimeouts(),null!==o?this.audio.stop():this.audio.pause(),this.audio.removeEventListener("ended",u),this.audio.removeEventListener("ended",r);var s={rt:n.rt,stimulus:t.stimulus,slider_start:t.slider_start,response:n.response};e.innerHTML="",this.jsPsych.finishTrial(s),i()};return new Promise(e=>{i=e})}simulate(e,t,s,r){"data-only"==t&&(r(),this.simulate_data_only(e,s)),"visual"==t&&this.simulate_visual(e,s,r)}create_simulation_data(e,t){const s={stimulus:e.stimulus,slider_start:e.slider_start,response:this.jsPsych.randomization.randomInt(e.min,e.max),rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0)},r=this.jsPsych.pluginAPI.mergeSimulationData(s,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,r),r}simulate_data_only(e,t){const s=this.create_simulation_data(e,t);this.jsPsych.finishTrial(s)}simulate_visual(e,t,s){const r=this.create_simulation_data(e,t),i=this.jsPsych.getDisplayElement(),a=()=>{if(null!==r.rt){const e=i.querySelector("input[type='range']");setTimeout(()=>{this.jsPsych.pluginAPI.clickTarget(e),e.valueAsNumber=r.response},r.rt/2),this.jsPsych.pluginAPI.clickTarget(i.querySelector("button"),r.rt)}};this.trial(i,e,()=>{s(),e.response_allowed_while_playing?a():this.audio.addEventListener("ended",a)})}}return s.info=t,s}(jsPsychModule);