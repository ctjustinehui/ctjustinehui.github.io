var jsPsychWebgazerCalibrate=function(e){"use strict";const i={name:"webgazer-calibrate",parameters:{calibration_points:{type:e.ParameterType.INT,"default":[[10,10],[10,50],[10,90],[50,10],[50,50],[50,90],[90,10],[90,50],[90,90]],array:!0},calibration_mode:{type:e.ParameterType.SELECT,options:["click","view"],"default":"click"},point_size:{type:e.ParameterType.INT,"default":20},repetitions_per_point:{type:e.ParameterType.INT,"default":1},randomize_calibration_order:{type:e.ParameterType.BOOL,"default":!1},time_to_saccade:{type:e.ParameterType.INT,"default":1e3},time_per_point:{type:e.ParameterType.INT,"default":1e3}}};class t{constructor(e){this.jsPsych=e}trial(e,i){var t="\n          <div id='webgazer-calibrate-container' style='position: relative; width:100vw; height:100vh'>\n          </div>";e.innerHTML=t;var a=e.querySelector("#webgazer-calibrate-container"),r=0,n=-1,o=null;const s=()=>{o=i.randomize_calibration_order?this.jsPsych.randomization.shuffle(i.calibration_points):i.calibration_points,n=-1,c()},c=()=>{if(++n==o.length)++r==i.repetitions_per_point?p():s();else{var e=o[n];l(e)}},l=e=>{var t=`<div id="calibration-point" style="width:${i.point_size}px; height:${i.point_size}px; border-radius:${i.point_size}px; border: 1px solid #000; background-color: #333; position: absolute; left:${e[0]}%; top:${e[1]}%;"></div>`;a.innerHTML=t;var r=a.querySelector("#calibration-point");if("click"==i.calibration_mode&&(r.style.cursor="pointer",r.addEventListener("click",()=>{c()})),"view"==i.calibration_mode){var n=r.getBoundingClientRect(),o=n.left+n.width/2,s=n.top+n.height/2,l=performance.now()+i.time_to_saccade,p=performance.now()+i.time_to_saccade+i.time_per_point;const e=()=>{performance.now()>l&&this.jsPsych.extensions.webgazer.calibratePoint(o,s,"click"),performance.now()<p?requestAnimationFrame(e):c()};requestAnimationFrame(e)}},p=()=>{"click"==i.calibration_mode&&this.jsPsych.extensions.webgazer.stopMouseCalibration(),a.innerHTML="",d()},d=()=>{this.jsPsych.extensions.webgazer.pause(),this.jsPsych.extensions.webgazer.hidePredictions(),this.jsPsych.extensions.webgazer.hideVideo(),this.jsPsych.pluginAPI.clearAllTimeouts();var i={};e.innerHTML="",this.jsPsych.finishTrial(i)};(()=>{this.jsPsych.extensions.webgazer.resume(),"click"==i.calibration_mode&&this.jsPsych.extensions.webgazer.startMouseCalibration(),s()})()}}return t.info=i,t}(jsPsychModule);