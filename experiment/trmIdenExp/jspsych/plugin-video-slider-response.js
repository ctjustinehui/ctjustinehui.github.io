var jsPsychVideoSliderResponse=function(e){"use strict";const t={name:"video-slider-response",parameters:{stimulus:{type:e.ParameterType.VIDEO,pretty_name:"Video","default":undefined,array:!0},prompt:{type:e.ParameterType.HTML_STRING,pretty_name:"Prompt","default":null},width:{type:e.ParameterType.INT,pretty_name:"Width","default":""},height:{type:e.ParameterType.INT,pretty_name:"Height","default":""},autoplay:{type:e.ParameterType.BOOL,pretty_name:"Autoplay","default":!0},controls:{type:e.ParameterType.BOOL,pretty_name:"Controls","default":!1},start:{type:e.ParameterType.FLOAT,pretty_name:"Start","default":null},stop:{type:e.ParameterType.FLOAT,pretty_name:"Stop","default":null},rate:{type:e.ParameterType.FLOAT,pretty_name:"Rate","default":1},min:{type:e.ParameterType.INT,pretty_name:"Min slider","default":0},max:{type:e.ParameterType.INT,pretty_name:"Max slider","default":100},slider_start:{type:e.ParameterType.INT,pretty_name:"Slider starting value","default":50},step:{type:e.ParameterType.INT,pretty_name:"Step","default":1},labels:{type:e.ParameterType.HTML_STRING,pretty_name:"Labels","default":[],array:!0},slider_width:{type:e.ParameterType.INT,pretty_name:"Slider width","default":null},button_label:{type:e.ParameterType.STRING,pretty_name:"Button label","default":"Continue"},require_movement:{type:e.ParameterType.BOOL,pretty_name:"Require movement","default":!1},trial_ends_after_video:{type:e.ParameterType.BOOL,pretty_name:"End trial after video finishes","default":!1},trial_duration:{type:e.ParameterType.INT,pretty_name:"Trial duration","default":null},response_ends_trial:{type:e.ParameterType.BOOL,pretty_name:"Response ends trial","default":!0},response_allowed_while_playing:{type:e.ParameterType.BOOL,pretty_name:"Response allowed while playing","default":!0}}};class s{constructor(e){this.jsPsych=e}trial(e,t){function s(){document.querySelector("#jspsych-video-slider-response-response").disabled=!1,t.require_movement||(document.querySelector("#jspsych-video-slider-response-next").disabled=!1)}if(!Array.isArray(t.stimulus))throw new Error("\n        The stimulus property for the video-slider-response plugin must be an array\n        of files. See https://www.jspsych.org/latest/plugins/video-slider-response/#parameters\n      ");var r=7.5,a='<video id="jspsych-video-slider-response-stimulus-video"';t.width&&(a+=' width="'+t.width+'"'),t.height&&(a+=' height="'+t.height+'"'),t.autoplay&&null==t.start&&(a+=" autoplay "),t.controls&&(a+=" controls "),null!==t.start&&(a+=' style="visibility: hidden;"'),a+=">";var i=this.jsPsych.pluginAPI.getVideoBuffer(t.stimulus[0]);if(!i)for(var l=0;l<t.stimulus.length;l++){var n=t.stimulus[l];n.indexOf("?")>-1&&(n=n.substring(0,n.indexOf("?")));var o=n.substr(n.lastIndexOf(".")+1);"mov"==(o=o.toLowerCase())&&console.warn("Warning: video-slider-response plugin does not reliably support .mov files."),a+='<source src="'+n+'" type="video/'+o+'">'}var p='<div id="jspsych-video-slider-response-wrapper" style="margin: 100px 0px;">';p+='<div id="jspsych-video-slider-response-stimulus">'+(a+="</video>")+"</div>",p+='<div class="jspsych-video-slider-response-container" style="position:relative; margin: 0 auto 3em auto; width:',null!==t.slider_width?p+=t.slider_width+"px;":p+="auto;",p+='">',p+='<input type="range" class="jspsych-slider" value="'+t.slider_start+'" min="'+t.min+'" max="'+t.max+'" step="'+t.step+'" id="jspsych-video-slider-response-response"',t.response_allowed_while_playing||(p+=" disabled"),p+="></input><div>";for(var d=0;d<t.labels.length;d++){var u=100/(t.labels.length-1),y=d*(100/(t.labels.length-1));p+='<div style="border: 1px solid transparent; display: inline-block; position: absolute; left:calc('+y+"% - ("+u+"% / 2) - "+(y-50)/50*100*r/100+"px); text-align: center; width: "+u+'%;">',p+='<span style="text-align: center; font-size: 80%;">'+t.labels[d]+"</span>",p+="</div>"}p+="</div>",p+="</div>",p+="</div>",null!==t.prompt&&(p+="<div>"+t.prompt+"</div>");var m="";!t.require_movement&&t.response_allowed_while_playing||(m="disabled"),p+='<button id="jspsych-video-slider-response-next" class="jspsych-btn" '+m+">"+t.button_label+"</button>",e.innerHTML=p;var c=e.querySelector("#jspsych-video-slider-response-stimulus-video");i&&(c.src=i),c.onended=(()=>{t.trial_ends_after_video?f():t.response_allowed_while_playing||s()}),c.playbackRate=t.rate,null!==t.start&&(c.pause(),c.onseeked=(()=>{c.style.visibility="visible",c.muted=!1,t.autoplay?c.play():c.pause(),c.onseeked=(()=>{})}),c.onplaying=(()=>{c.currentTime=t.start,c.onplaying=(()=>{})}),c.muted=!0,c.play());let h=!1;if(null!==t.stop&&c.addEventListener("timeupdate",()=>{c.currentTime>=t.stop&&(c.pause(),t.trial_ends_after_video&&!h&&(h=!0,f()),t.response_allowed_while_playing||s())}),t.require_movement){const t=()=>{e.querySelector("#jspsych-video-slider-response-next").disabled=!1};e.querySelector("#jspsych-video-slider-response-response").addEventListener("mousedown",t),e.querySelector("#jspsych-video-slider-response-response").addEventListener("touchstart",t),e.querySelector("#jspsych-video-slider-response-response").addEventListener("change",t)}var v=performance.now(),_={rt:null,response:null};const f=()=>{this.jsPsych.pluginAPI.clearAllTimeouts(),e.querySelector("#jspsych-video-slider-response-stimulus-video").pause(),e.querySelector("#jspsych-video-slider-response-stimulus-video").onended=(()=>{});var s={rt:_.rt,stimulus:t.stimulus,start:t.start,slider_start:t.slider_start,response:_.response};e.innerHTML="",this.jsPsych.finishTrial(s)};e.querySelector("#jspsych-video-slider-response-next").addEventListener("click",()=>{var s=performance.now();_.rt=Math.round(s-v),_.response=e.querySelector("#jspsych-video-slider-response-response").valueAsNumber,t.response_ends_trial?f():e.querySelector("#jspsych-video-slider-response-next").disabled=!0}),null!==t.trial_duration&&this.jsPsych.pluginAPI.setTimeout(f,t.trial_duration)}simulate(e,t,s,r){"data-only"==t&&(r(),this.simulate_data_only(e,s)),"visual"==t&&this.simulate_visual(e,s,r)}create_simulation_data(e,t){const s={stimulus:e.stimulus,slider_start:e.slider_start,response:this.jsPsych.randomization.randomInt(e.min,e.max),rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),start:e.start},r=this.jsPsych.pluginAPI.mergeSimulationData(s,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,r),r}simulate_data_only(e,t){const s=this.create_simulation_data(e,t);this.jsPsych.finishTrial(s)}simulate_visual(e,t,s){const r=this.create_simulation_data(e,t),a=this.jsPsych.getDisplayElement();this.trial(a,e),s();const i=a.querySelector("#jspsych-video-button-response-stimulus"),l=()=>{if(null!==r.rt){const e=a.querySelector("input[type='range']");setTimeout(()=>{this.jsPsych.pluginAPI.clickTarget(e),e.valueAsNumber=r.response},r.rt/2),this.jsPsych.pluginAPI.clickTarget(a.querySelector("button"),r.rt)}};e.response_allowed_while_playing?l():i.addEventListener("ended",l)}}return s.info=t,s}(jsPsychModule);