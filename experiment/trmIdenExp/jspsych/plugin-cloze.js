var jsPsychCloze=function(t){"use strict";const e={name:"cloze",parameters:{text:{type:t.ParameterType.HTML_STRING,pretty_name:"Cloze text","default":undefined},button_text:{type:t.ParameterType.STRING,pretty_name:"Button text","default":"OK"},check_answers:{type:t.ParameterType.BOOL,pretty_name:"Check answers","default":!1},allow_blanks:{type:t.ParameterType.BOOL,pretty_name:"Allow blanks","default":!0},mistake_fn:{type:t.ParameterType.FUNCTION,pretty_name:"Mistake function","default":()=>{}}}};class s{constructor(t){this.jsPsych=t}trial(t,e){var s='<div class="cloze">',n=e.text.split("%");const a=this.getSolutions(e.text);let i=0;for(var l=0;l<n.length;l++)l%2==0?s+=n[l]:(s+=`<input type="text" id="input${i}" value="">`,i++);s+="</div>",t.innerHTML=s;const o=()=>{for(var s=[],n=!0,i=!0,l=0;l<a.length;l++){var o=document.getElementById("input"+l);s.push(o.value.trim()),e.check_answers&&(s[l]!==a[l]?(o.style.color="red",n=!1):o.style.color="black"),e.allow_blanks||""===s[l]&&(i=!1)}if(e.check_answers&&!n||!e.allow_blanks&&!i)e.mistake_fn();else{var r={response:s};t.innerHTML="",this.jsPsych.finishTrial(r)}};t.innerHTML+='<br><button class="jspsych-html-button-response-button" type="button" id="finish_cloze_button">'+e.button_text+"</button>",t.querySelector("#finish_cloze_button").addEventListener("click",o)}getSolutions(t){const e=[],s=t.split("%");for(let t=0;t<s.length;t++)t%2==1&&e.push(s[t].trim());return e}simulate(t,e,s,n){"data-only"==e&&(n(),this.simulate_data_only(t,s)),"visual"==e&&this.simulate_visual(t,s,n)}create_simulation_data(t,e){const s=this.getSolutions(t.text),n=[];for(const t of s)""==t?n.push(this.jsPsych.randomization.randomWords({exactly:1})):n.push(t);const a={response:n};return this.jsPsych.pluginAPI.mergeSimulationData(a,e)}simulate_data_only(t,e){const s=this.create_simulation_data(t,e);this.jsPsych.finishTrial(s)}simulate_visual(t,e,s){const n=this.create_simulation_data(t,e),a=this.jsPsych.getDisplayElement();this.trial(a,t),s();const i=a.querySelectorAll('input[type="text"]');let l=this.jsPsych.randomization.sampleExGaussian(750,200,.01,!0);for(let t=0;t<n.response.length;t++)this.jsPsych.pluginAPI.fillTextInput(i[t],n.response[t],l),l+=this.jsPsych.randomization.sampleExGaussian(750,200,.01,!0);this.jsPsych.pluginAPI.clickTarget(a.querySelector("#finish_cloze_button"),l)}}return s.info=e,s}(jsPsychModule);