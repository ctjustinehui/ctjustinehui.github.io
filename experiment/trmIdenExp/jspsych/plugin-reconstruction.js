var jsPsychReconstruction=function(e){"use strict";const t={name:"reconstruction",parameters:{stim_function:{type:e.ParameterType.FUNCTION,pretty_name:"Stimulus function","default":undefined},starting_value:{type:e.ParameterType.FLOAT,pretty_name:"Starting value","default":.5},step_size:{type:e.ParameterType.FLOAT,pretty_name:"Step size","default":.05},key_increase:{type:e.ParameterType.KEY,pretty_name:"Key increase","default":"h"},key_decrease:{type:e.ParameterType.KEY,pretty_name:"Key decrease","default":"g"},button_label:{type:e.ParameterType.STRING,pretty_name:"Button label","default":"Continue"}}};class s{constructor(e){this.jsPsych=e}trial(e,t){var s=t.starting_value;const a=()=>{var a=performance.now(),n=Math.round(a-c);this.jsPsych.pluginAPI.cancelKeyboardResponse(r);var i={rt:n,final_value:s,start_value:t.starting_value};e.innerHTML="",this.jsPsych.finishTrial(i)},n=s=>{e.innerHTML='<div id="jspsych-reconstruction-stim-container">'+t.stim_function(s)+"</div>",e.innerHTML+='<button id="jspsych-reconstruction-next" class="jspsych-btn jspsych-reconstruction">'+t.button_label+"</button>",e.querySelector("#jspsych-reconstruction-next").addEventListener("click",a)},i=e=>{var a=t.key_increase,i=t.key_decrease;this.jsPsych.pluginAPI.compareKeys(e.key,a)?s+=t.step_size:this.jsPsych.pluginAPI.compareKeys(e.key,i)&&(s-=t.step_size),s=Math.max(Math.min(1,s),0),n(s)};var r=this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:i,valid_responses:[t.key_increase,t.key_decrease],rt_method:"performance",persist:!0,allow_held_key:!0});n(s);var c=performance.now()}simulate(e,t,s,a){"data-only"==t&&(a(),this.simulate_data_only(e,s)),"visual"==t&&this.simulate_visual(e,s,a)}create_simulation_data(e,t){const s={rt:this.jsPsych.randomization.sampleExGaussian(2e3,200,.005,!0),start_value:e.starting_value,final_value:this.jsPsych.randomization.randomInt(0,Math.round(1/e.step_size))*e.step_size},a=this.jsPsych.pluginAPI.mergeSimulationData(s,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,a),a}simulate_data_only(e,t){const s=this.create_simulation_data(e,t);this.jsPsych.finishTrial(s)}simulate_visual(e,t,s){const a=this.create_simulation_data(e,t),n=this.jsPsych.getDisplayElement();this.trial(n,e),s();let i=Math.round((a.final_value-e.starting_value)/e.step_size);const r=(a.rt-300)/i;let c=0;for(;0!=i;)i>0?(this.jsPsych.pluginAPI.pressKey(e.key_increase,c+r),i--):(this.jsPsych.pluginAPI.pressKey(e.key_decrease,c+r),i++),c+=r;this.jsPsych.pluginAPI.clickTarget(n.querySelector("#jspsych-reconstruction-next"),a.rt)}}return s.info=t,s}(jsPsychModule);